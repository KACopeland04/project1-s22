<!DOCTYPE html>
<!-- <html>
<head>
    <title>google map</title>
    <script src="{{url_for('static', filename='map.js')}}"></script>
</head>
<body>

<h1>My First Google Map</h1>

<div id="googleMap" style="width:100%;height:750px;"></div>

<button onClick="testData()">click me now</button>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOjBlneiz6modsQUWGeGi0sFhXyQgN8pU&callback=myMap"></script>
<script src="{{url_for('static', filename='map.js')}}"></script>
</body>
</html> -->

<html>
<head runat="server">
    <title></title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {
        'packages':['geochart'],
        // Note: you will need to get a mapsApiKey for your project.
        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
        'mapsApiKey': 'map_api_key'
        });
        google.charts.setOnLoadCallback(drawRegionsMap("temperature"));
        google.charts.setOnLoadCallback(drawMarkersMap);

        function drawRegionsMap(datafunction) {
            fetch("/"+datafunction)
            .then(data => data.json())
            .then(data => {
                console.log(data);
                var data_array = [['State','Status']];
                Object.entries(data).forEach(([key, value]) => {
                    data_array.push([key, value])
                });
                console.log(data_array)
                datatable = google.visualization.arrayToDataTable(data_array);
                var options = {};
                options['region'] = 'US';
                options['colors'] = ['green', 'yellow', 'red']; 
                options['values'] =  [0, 1, 2]
                options['dataMode'] = 'markers';
                options['resolution'] = 'provinces';

                var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

                chart.draw(datatable, options);
                });
        }

        function drawMarkersMap() {
            fetch("/selfreporteddata")
            .then(data => data.json())
            .then(data => {
                console.log(data);
                var i = 0;
                var data_array = [['lat','lng', 'Description', 'size']];
                Object.entries(data).forEach(([key, value]) => {
                    data_array.push([value[1][0], value[1][1], value[0], i]);
                    if (i == 1) {
                        i = 0;
                    }
                    else {
                        i = 1;
                    }
            });
            console.log(data_array)
            datatable = google.visualization.arrayToDataTable(data_array);
            var options = {
                region: 'US',
                displayMode: 'markers',
                colorAxis: {colors:['black', 'black']},
                sizeAxis: {minSize: 4, maxSize: 4},
                datalessRegionColor: 'transparent',
                backgroundColor: 'transparent',
                legend: 'none'
            };
            var chart = new google.visualization.GeoChart(document.getElementById('self_div'));
            chart.draw(datatable, options);
        });
    }

   </script>
</head>
    <body>
        <div id="regions_div" style="width: 900px; height: 500px; position: absolute; top: 0px; left: 0px;"></div>
        <div id="self_div" style="width: 900px; height: 500px; position: absolute; top: 0px; left: 0px;"></div>
    </body>
</html>
